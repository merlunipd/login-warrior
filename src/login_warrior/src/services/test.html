<script>
    class IndexedDB /** implements Storage*/ {
    #request = null;
    #db = null;
    #datasetDB = null;
    #customizationDB = null;
    #visualizationDB = null;

    
    async #openIndexedDB(){
        let promise = new Promise((resolve,reject) => {
            this.#request = indexedDB.open("Login-Warrior");

            this.#request.onupgradeneeded = e => {
            this.#db = e.target.result;
            const datasetDB = this.#db.createObjectStore("DatasetDB",{autoIncrement: true});  
            alert("DB aggiornato");
        }

            this.#request.onsuccess = e => {
                alert("onsuccess")
                this.#db = e.target.result;
            }

            this.#request.onerror = e => {
                alert("onerror")
                this.#db = e.target.result;
            }
        });
        let result = await promise;

    }

    constructor(){
        this.#openIndexedDB();  
    }

/**
 * Da fixare il problemino Failed to execute 'transaction' on 'IDBDatabase' ,
 * dovuto alla mancanza dell'oggetto Dtataset nel Db. Questo oggetto non
 * puÃ² essere generato  in onsuccess..
 * 
 * Da vedere come fare, la parte di sincronizzazione dovrebbe essere ok
 * 
*/

    async saveDataset(d){
        let promise = new Promise((resolve,reject) => {
            this.#request = indexedDB.open("Login-Warrior");

            this.#request.onsuccess = e => {
                alert("onsuccess savedata")
                const DatasetData = {
                    title: "Dataset",
                    text: d
                }
                this.#db = e.target.result;
                const tx = this.#db.transaction("Dataset", "readwrite");
                const Added = tx.objectStore("Dataset");
                Added.add(DatasetData);
                alert("Dati aggiunti con successo");
            }

            this.#request.onupgradeneeded = e => {
                alert("Aggiornamento avvenuto con successo");
            }

            this.#request.onerror = e => {
                alert("Errore nell'aggiunta dei dati");
            }

        });
        let result = await promise;
    }

    loadDataset(){}

    saveCustomization(c){}

    loadCustomization(){}

    saveVisualizationIndex(index){}

    loadVisualizationIndex(){}

    

}

let a = new IndexedDB();
a.saveDataset("ciao");
</script>